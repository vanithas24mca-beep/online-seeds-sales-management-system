<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Payment Method</title>
  <style>
    /* Your existing CSS from the original payment.html */
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #e0f7e9, #f5fff8);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .container {
      width: 90%;
      max-width: 600px;
      margin: 50px auto;
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
      text-align: center;
      flex-grow: 1;
    }
    h2 {
      color: #2e7d32;
      margin-bottom: 25px;
      font-size: 28px;
    }
    .payment-option {
      text-align: left;
      padding: 15px;
      margin: 15px 0;
      border: 2px solid #c8e6c9;
      border-radius: 12px;
      background: #f9fff9;
      transition: 0.3s;
      cursor: pointer;
    }
    .payment-option:hover {
      border-color: #2e7d32;
      background: #f0fdf4;
    }
    .payment-option input {
      margin-right: 12px;
      transform: scale(1.2);
    }
    .confirm-btn {
      margin-top: 25px;
      padding: 14px;
      width: 100%;
      background: linear-gradient(135deg, #2e7d32, #388e3c);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, background 0.3s;
    }
    .confirm-btn:hover {
      background: linear-gradient(135deg, #1b5e20, #2e7d32);
      transform: translateY(-2px);
    }
    .info {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      background: #e3f2fd;
      color: #1565c0;
      border: 2px solid #1565c0;
      display: none;
    }
    .app-buttons {
      margin-top: 20px;
      display: none;
    }
    .app-buttons button {
      margin: 10px;
      padding: 12px 20px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    .phonepe { background: #5e35b1; color: white; }
    .gpay { background: #1976d2; color: white; }
    .paytm { background: #00bcd4; color: white; }
    .app-buttons button:hover {
      opacity: 0.8;
      transform: translateY(-2px);
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      width: 300px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .modal-content h3 {
      margin-bottom: 15px;
      color: #2e7d32;
    }
    .pay-btn {
      margin-top: 15px;
      padding: 10px 20px;
      background: #2e7d32;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .pay-btn:hover {
      background: #1b5e20;
    }
    .success-message {
      text-align: center;
      padding: 15px;
      font-size: 18px;
      font-weight: bold;
      color: #2e7d32;
      background: #e8f5e9;
      border-top: 2px solid #2e7d32;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Select Payment Method</h2>
    <div class="payment-option">
      <input type="radio" name="payment" id="cod" checked>
      <label for="cod">ðŸ’µ Cash on Delivery</label>
    </div>
    <div class="payment-option">
      <input type="radio" name="payment" id="online">
      <label for="online">ðŸ’³ Online Payment (Card/UPI/Net Banking)</label>
    </div>
    <button class="confirm-btn" onclick="confirmPayment()">âœ… Confirm Payment</button>
    <div id="infoBox" class="info"></div>
    <div class="app-buttons" id="appButtons">
      <button class="phonepe" onclick="showModal('PhonePe')">ðŸ“± Pay with PhonePe</button>
      <button class="gpay" onclick="showModal('Google Pay')">ðŸ’³ Pay with Google Pay</button>
      <button class="paytm" onclick="showModal('Paytm')">ðŸ’° Pay with Paytm</button>
    </div>
  </div>

  <div class="modal" id="paymentModal">
    <div class="modal-content">
      <h3 id="modalTitle"></h3>
      <p id="modalAmount"></p>
      <button class="pay-btn" onclick="completePayment()">Pay</button>
    </div>
  </div>

  <div id="successMessage" class="success-message"></div>

  <script>
    // Simulated order object - replace with your actual order logic or fetching
    let pendingOrder = JSON.parse(localStorage.getItem("pendingOrder") || "{}");

    if (!pendingOrder || !pendingOrder.items || pendingOrder.items.length === 0) {
      alert("No order data found. Please add items to your cart first.");
      window.location.href = "addtocart.html";
    }

    function confirmPayment() {
      const codChecked = document.getElementById("cod").checked;
      const paymentMethod = codChecked ? "COD" : "ONLINE";

      if (paymentMethod === "COD") {
        document.getElementById("infoBox").innerHTML =
          `âœ… Your order has been placed.<br>ðŸ’° Please pay â‚¹${pendingOrder.total} at delivery.`;
        document.getElementById("infoBox").style.display = "block";
        document.getElementById("appButtons").style.display = "none";

        sendOrder({ ...pendingOrder, paymentMethod });
      } else {
        document.getElementById("infoBox").innerHTML =
          `ðŸ’³ Select your payment app:<br>ðŸ’° Amount: â‚¹${pendingOrder.total}`;
        document.getElementById("infoBox").style.display = "block";
        document.getElementById("appButtons").style.display = "block";
      }
    }

    function showModal(appName) {
      document.getElementById("modalTitle").innerText = "Pay with " + appName;
      document.getElementById("modalAmount").innerText = "Total: â‚¹" + pendingOrder.total;
      document.getElementById("paymentModal").style.display = "flex";
    }

    function completePayment() {
      document.getElementById("paymentModal").style.display = "none";
      document.getElementById("successMessage").innerHTML =
        `âœ… Payment of â‚¹${pendingOrder.total} completed successfully!`;
      document.getElementById("successMessage").style.display = "block";

      sendOrder({ ...pendingOrder, paymentMethod: "ONLINE" });
    }

    function sendOrder(orderData) {
      // Here, add a customer object for demo purposes
      if (!orderData.customer) {
        orderData.customer = {
          name: "John Doe",
          email: "john@example.com",
          phone: "1234567890"
        };
      }

      fetch("/api/placeOrder", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(orderData)
      })
      .then(res => res.json())
      .then(resJson => {
        if (resJson.success) {
          localStorage.removeItem("pendingOrder");
          window.location.href = `order-success.html?orderId=${resJson.orderId}`;
        } else {
          alert("Error placing order: " + (resJson.error || "Unknown"));
        }
      })
      .catch(err => {
        alert("Server error: " + err.message);
      });
    }
  </script>
</body>
</html>
